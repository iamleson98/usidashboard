import{e as L,u as Y,i as H,a as N,b as B,c as C,d as E,f as W,g as j,h as A,j as P,k as T,l as F,m as I,n as R,o as V,p as J}from"./echarts.CBTQgbh5.2025-06-26_1059.js";import{d as U}from"./lodash-es.S0Y0Up6J.2025-06-26_1059.js";import{d as y,r as h,j as $,w as q,W as k,I as G,u as b,c as D,o as M,P as t,H as n,ag as _,L as w,a as s,M as f}from"./@vue.BDy9tIRg.2025-06-26_1059.js";import{s as K}from"./serviceConfig.BWJVFB0i.2025-06-26_1059.js";import{d as g}from"./dayjs.DXEKZA6n.2025-06-26_1059.js";import{_ as Q}from"./plugin-vueexport-helper.DlAUqK2U.2025-06-26_1059.js";import"./zrender.CCLwuTvH.2025-06-26_1059.js";import"./tslib.BDyQ-Jie.2025-06-26_1059.js";Y([H,N,B,C,E,W,j,A,P,T,F,I,R,V,J]);const O=new WeakMap,x=new ResizeObserver(i=>{for(const a of i){const r=a.target,o=O.get(r);if(o){const p=a.borderBoxSize[0],c={width:p.inlineSize,height:p.blockSize};o(c)}}}),X={beforeMount(i,a){x.observe(i,{box:"border-box"});const r=U(a.value,200);O.set(i,r)},unmounted(i){x.unobserve(i)}},Z=y({__name:"Chart",props:{option:{},registerMap:{type:Function}},setup(i){const a=i,r=h();let o=null;const p=()=>{o&&o.setOption(a.option)};$(()=>{o=L.init(r.value),o.setOption(a.option)}),q(()=>a.option,e=>{p()},{deep:!0}),k(()=>{c()});function c(){o&&(o.dispose(),o=null)}return(e,d)=>G((M(),D("div",{ref_key:"chartEl",ref:r},null,512)),[[b(X),p]])}}),ee=y({__name:"Dashboard",setup(i){const a=h(),r=h([]),o=[1,2,3,4].map(c=>`floor ${c}`);let p=h({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:o},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",axisTick:{alignWithLabel:!0}}],yAxis:[{type:"value"}],series:[{name:"Live count",type:"line",label:{show:!0,position:"top",formatter:"{c}"}}]});return $(()=>{a.value=new WebSocket(`${K.usiApi}/checking-events/live-attendances`),a.value.onmessage=async c=>{const e=JSON.parse(JSON.parse(c.data));if(e.aggregations){p.value.xAxis=[{type:"category",data:e.aggregations.live_attendances.map(m=>g(m.time).format("DD/MM HH:mm")),axisTick:{alignWithLabel:!0}}];const d={};e.aggregations.live_attendances.forEach((m,v)=>{for(const l in m.live_count)d[l]||(d[l]={data:[],name:l,type:"line",label:{show:!0,position:"top",formatter:"{c}"}}),d[l].data.push(m.live_count[l])}),p.value.series=Object.values(d)}r.value=e.abnormal_cases}}),k(()=>{a.value&&a.value.close()}),(c,e)=>{const d=_("el-text"),m=_("el-card"),v=_("el-col"),l=_("el-table-column"),S=_("el-table"),z=_("el-row");return M(),D("div",null,[t(z,{gutter:20},{default:n(()=>[t(v,{span:12},{default:n(()=>[t(m,{shadow:"never"},{default:n(()=>[t(d,{class:"my-2",size:"large"},{default:n(()=>e[0]||(e[0]=[w("Production line realtime heads count")])),_:1}),t(Z,{option:b(p),style:{height:"410px"}},null,8,["option"])]),_:1})]),_:1}),t(v,{span:12},{default:n(()=>[t(m,{shadow:"never"},{default:n(()=>[t(d,{class:"my-2",size:"large"},{default:n(()=>e[1]||(e[1]=[w("Production line realtime abnormal cases")])),_:1}),t(S,{stripe:"",style:{width:"100%"},ref:"tableRef",data:b(r)},{default:n(()=>[t(l,{fixed:"",type:"index",width:"50",label:"No."}),t(l,{prop:"employee_id",label:"Employee",width:"100"},{default:n(u=>[s("div",null,[s("p",null,f(u.row.employee_id),1),s("p",null,f(u.row.first_name+" "+u.row.last_name),1)])]),_:1}),t(l,{prop:"department",label:"Department",width:"150"}),t(l,{prop:"out_time",label:"Out time",sortable:"custom",width:"170"},{default:n(u=>[s("div",null,[s("p",null,f(b(g)(u.row.out_time).format("YYYY/MM/DD HH:mm")),1),e[2]||(e[2]=s("hr",null,null,-1)),s("p",null,f(u.row.checkout_station),1)])]),_:1}),t(l,{prop:"in_time",label:"In time",sortable:"custom",width:"170"},{default:n(u=>[s("div",null,[s("p",null,f(b(g)(u.row.in_time).format("YYYY/MM/DD HH:mm")),1),e[3]||(e[3]=s("hr",null,null,-1)),s("p",null,f(u.row.checkin_station),1)])]),_:1}),t(l,{prop:"total_mins",label:"gap time (minutes)",sortable:"custom"})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})])}}}),pe=Q(ee,[["__scopeId","data-v-af5e5c64"]]);export{pe as default};
